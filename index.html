<!DOCTYPE html>
<html>

<head>
  <title>SSH Hardening Guides</title>
  <meta http-equiv="content-type" content="text/html; charset=iso-8859-1" />
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" type="image/png" href="/favicon.ico">
  <link rel="stylesheet" type="text/css" href="main.css" />
  <script type="text/javascript" src="hardening_guides.js"></script>
</head>

<body>
  <div id="content">
    <div id="header">
      <div id="logo">
        <a href="https://www.positronsecurity.com/"><img class="logo" src="logos/positron-security.png" /></a>
      </div>
      <div id="nav"><a class="navlink" href="https://www.ssh-audit.com/">Home</a></div>
      <br class="clear" />
    </div>
    <h1>SSH Hardening Guides</h1>
    <p>Below are guides to hardening SSH on various systems. Note that following them may not result in a perfect
      auditing score, as not all packaged SSH server versions support the required options. However, these instructions
      will result in the best possible score.</p>
    <p>These guides were inspired by <a href="https://stribika.github.io/2015/01/04/secure-secure-shell.html">this
        document</a> (which is now out-dated).</p>
    <p>
    <h3>Server Guides:</h3>
    </p>
    <p>
    <ol class="system_list">
      <li><a href="#amazon_linux_2023">Amazon Linux 2023</a></li>
      <li><a href="#debian_11">Debian 11 (Bullseye)</a></li>
      <li><a href="#debian_12">Debian 12 (Bookworm)</a></li>
      <li><a href="#rocky_9">Rocky Linux 9</a></li>
      <li><a href="#ubuntu_20_04_lts">Ubuntu 20.04 LTS</a></li>
      <li><a href="#ubuntu_22_04_lts">Ubuntu 22.04 LTS</a></li>
      <li><a href="#ubuntu_24_04_lts.html">Ubuntu 24.04 LTS</a></li>
    </ol>
    </p>
    <p>
    <h3>Client Guides:</h3>
    </p>
    <p>
    <ol class="system_list">
      <li><a href="client_guides.html#amazon_linux_2023_client">Amazon Linux 2023</a></li>
      <li><a href="client_guides.html#debian_12_client">Debian 12 (Bookworm)</a></li>
      <li><a href="client_guides.html#rocky_9_client">Rocky Linux 9</a></li>
      <li><a href="client_guides.html#ubuntu_20_04_linux_mint_20">Ubuntu 20.04 LTS / Linux Mint 20</a></li>
      <li><a href="client_guides.html#ubuntu_22_04_linux_mint_21">Ubuntu 22.04 LTS / Linux Mint 21</a></li>
      <li><a href="client_guides.html#ubuntu_24_04_client">Ubuntu 24.04 LTS / Linux Mint 22</a></li>
    </ol>
    </p>

    <p>
    <h3>Community-Developed Guides:</h3>
    </p>
    <p>The following guides have been written by the community. They have not been officially tested, and are not
      officially supported:</p>
    <p>
    <ol class="system_list">
      <li><a href="https://github.com/jtesta/ssh-audit/wiki/ArubaOS-Switch-(AOS-S)-16.11">ArubaOS Switch (AOS S)
          16.11</a></li>
      <li><a href="https://github.com/jtesta/ssh-audit/wiki/Dropbear-2022.83">Dropbear 2022.83</a></li>
      <li><a href="https://github.com/jtesta/ssh-audit/wiki/Extreme-Networks-(Fabric-Engine-and-Switch-Engine)">Extreme
          Networks (Fabric Engine and Switch Engine)</a></li>
      <li><a href="https://github.com/jtesta/ssh-audit/wiki/Fortinet-FortiOS">Fortinet FortiOS</a></li>
      <li><a href="https://github.com/jtesta/ssh-audit/wiki/FreeBSD">FreeBSD (various versions)</a></li>
      <li><a href="https://github.com/jtesta/ssh-audit/wiki/macOS-13-(Ventura)-&-14-(Sonoma)">Mac OS 13 (Ventura) & 14
          (Sonoma)</a></li>
      <li><a href="https://github.com/jtesta/ssh-audit/wiki/Mikrotik-RouterOS">Mikrotik RouterOS</a></li>
      <li><a href="https://github.com/jtesta/ssh-audit/wiki/OPNsense-20.7-and-newer">OPNsense 20.7 and newer</a></li>
      <li><a href="https://github.com/jtesta/ssh-audit/wiki/Proxmox-VE-7.3-6">Proxmox-VE-7.3-6</a></li>
      <li><a href="https://github.com/jtesta/ssh-audit/wiki/Synology-DSM">Synology DSM</a></li>
      <li><a href="https://github.com/jtesta/ssh-audit/wiki/Void-Linux">Void Linux</a></li>
    </ol>
    </p>
    <p>Instructions for submitting a hardening guide <a
        href="https://github.com/jtesta/ssh-audit/wiki/SSH-Hardening-Guides-Index">can be found here</a>.</p>

    <p>
    <h3>Legacy Guides:</h3>
    </p>
    <p>
    <ol class="system_list">
      <li><a href="legacy_guides.html#debian_10">Debian Buster (Debian 10)</a></li>
      <li><a href="legacy_guides.html#openbsd_6_2">OpenBSD 6.2</a></li>
      <li><a href="legacy_guides.html#pfsense_2_4">pfSense 2.4</a></li>
      <li><a href="legacy_guides.html#rhel7">RedHat Enterprise Linux 7 / CentOS 7</a></li>
      <li><a href="legacy_guides.html#rhel8">RedHat Enterprise Linux 8 / CentOS 8</a></li>
      <li><a href="legacy_guides.html#ubuntu_14_04_lts">Ubuntu 14.04 LTS</a></li>
      <li><a href="legacy_guides.html#ubuntu_16_04_lts">Ubuntu 16.04 LTS (Server)</a></li>
      <li><a href="legacy_guides.html#ubuntu_16_04_linux_mint_18">Ubuntu 16.04 LTS / Linux Mint 18 (Client)</a>
      </li>
      <li><a href="legacy_guides.html#ubuntu_18_04_lts">Ubuntu 18.04 LTS</a></li>
      <li><a href="legacy_guides.html#ubuntu_18_04_linux_mint_19">Ubuntu 18.04 LTS / Linux Mint 19 (Client)</a>
      </li>
      <li><a href="legacy_guides.html#ubuntu_core_16">Ubuntu Core 16</a></li>
      <li><a href="legacy_guides.html#ubuntu_core_18">Ubuntu Core 18</a></li>
    </ol>
    </p>

    <hr>

    <div id="ubuntu_24_04_lts">
      <p>
      <h2 class="os-title"><img src="logos/ubuntu.png" /> Ubuntu 24.04 LTS Server <span class="last_modified">Last
          modified:
          September 1, 2025</span><span class="copy_button"><input class="copy_button" type="button"
            value="Copy commands to clipboard" /></span></h2>
      </p>
      <div class="change_log">
        <p>Change Log:</p>
        <ol>
          <li>September 1, 2025: Removed commands directly editing sshd_config to make system updates easier for users.
          </li>
          <li>October 1, 2024: Added RequiredRSASize directive to enforce a minimum of 3072-bit user and host-based
            authentication keys.</li>
          <li>April 29, 2024: Initial revision. In comparison to Ubuntu 22.04 LTS guide, the following changes were
            made: 1.) For key exchanges, diffie-hellman-group18-sha512 and diffie-hellman-group-exchange-sha256 were
            prioritized over diffie-hellman-group16-sha512 due to greater security strength; GSS algorithms were
            prioritized over their non-GSS equivalents in order to match the client guide, 2.) For ciphers, 256-bit AES
            ciphers were prioritized over 192 and 128-bit AES ciphers due to their increased resistence against quantum
            computing attacks (previously, weaker GCM ciphers had priority over CTR ciphers), 3.) The
            HostbasedAcceptedAlgorithms and PubkeyAcceptedAlgorithms settings are now the same as HostKeyAlgorithms
            setting, 4.) The hmac-sha2-512-etm@openssh.com MAC was increased in priority due to its increased resistence
            against quantum computing attacks, and 5.) The ED25519 host keys were given priority over RSA host keys due
            to their greater efficiency.</li>
        </ol>
      </div>
      <p><u>Note</u>: all commands below are to be executed as the <i>root</i> user.
      <ol>
        <li>
          <h3>Re-generate the ED25519 and RSA keys</h3><span class="commands">rm /etc/ssh/ssh_host_*<br>
            ssh-keygen -t ed25519 -f /etc/ssh/ssh_host_ed25519_key -N ""<br>
            ssh-keygen -t rsa -b 4096 -f /etc/ssh/ssh_host_rsa_key -N ""
          </span>
        </li>
        <li>
          <h3>Remove small Diffie-Hellman moduli</h3><span class="commands">awk '$5 >= 3071' /etc/ssh/moduli >
            /etc/ssh/moduli.safe<br>
            mv /etc/ssh/moduli.safe /etc/ssh/moduli</span>
        </li>
        <li>
          <h3>Restrict supported key exchange, cipher, and MAC algorithms</h3><span class="commands">echo -e "# Restrict
            key exchange, cipher, and MAC algorithms, as per sshaudit.com\n# hardening guide.\nKexAlgorithms
            sntrup761x25519-sha512@openssh.com,gss-curve25519-sha256-,curve25519-sha256,curve25519-sha256@libssh.org,diffie-hellman-group18-sha512,diffie-hellman-group-exchange-sha256,gss-group16-sha512-,diffie-hellman-group16-sha512\n\nCiphers
            chacha20-poly1305@openssh.com,aes256-gcm@openssh.com,aes256-ctr,aes192-ctr,aes128-gcm@openssh.com,aes128-ctr\n\nMACs
            hmac-sha2-512-etm@openssh.com,hmac-sha2-256-etm@openssh.com,umac-128-etm@openssh.com\n\nRequiredRSASize
            3072\n\nHostKeyAlgorithms
            sk-ssh-ed25519-cert-v01@openssh.com,ssh-ed25519-cert-v01@openssh.com,rsa-sha2-512-cert-v01@openssh.com,rsa-sha2-256-cert-v01@openssh.com,sk-ssh-ed25519@openssh.com,ssh-ed25519,rsa-sha2-512,rsa-sha2-256\n\nCASignatureAlgorithms
            sk-ssh-ed25519@openssh.com,ssh-ed25519,rsa-sha2-512,rsa-sha2-256\n\nGSSAPIKexAlgorithms
            gss-curve25519-sha256-,gss-group16-sha512-\n\nHostbasedAcceptedAlgorithms
            sk-ssh-ed25519-cert-v01@openssh.com,ssh-ed25519-cert-v01@openssh.com,rsa-sha2-512-cert-v01@openssh.com,rsa-sha2-256-cert-v01@openssh.com,sk-ssh-ed25519@openssh.com,ssh-ed25519,rsa-sha2-512,rsa-sha2-256\n\nPubkeyAcceptedAlgorithms
            sk-ssh-ed25519-cert-v01@openssh.com,ssh-ed25519-cert-v01@openssh.com,rsa-sha2-512-cert-v01@openssh.com,rsa-sha2-256-cert-v01@openssh.com,sk-ssh-ed25519@openssh.com,ssh-ed25519,rsa-sha2-512,rsa-sha2-256"
            > /etc/ssh/sshd_config.d/ssh-audit_hardening.conf</span>
        </li>
        <li>
          <h3>Restart OpenSSH server</h3><span class="commands">service ssh restart</span>
        </li>
        <li>
          <h3>Implement connection rate throttling</h3>
          <p>Connection rate throttling is needed in order to protect against the <a
              href="https://www.positronsecurity.com/blog/2024-04-23-an-analysis-of-dheat-dos-against-ssh-in-cloud-environments/">DHEat
              denial-of-service attack</a>. A complete and flexible solution is to use iptables to allow up to 10
            connections every 10 seconds from any one source address. An alternate solution is to set OpenSSH's
            PerSourceMaxStartups directive to 1 (note, however, that this can cause incomplete results during ssh-audit
            scans, as well as other client failures when bursts of connections are made).</p><span
            class="commands">iptables -I INPUT -p tcp --dport 22 -m state --state NEW -m recent --set<br>
            iptables -I INPUT -p tcp --dport 22 -m state --state NEW -m recent --update --seconds 10 --hitcount 10 -j
            DROP<br>
            ip6tables -I INPUT -p tcp --dport 22 -m state --state NEW -m recent --set<br>
            ip6tables -I INPUT -p tcp --dport 22 -m state --state NEW -m recent --update --seconds 10 --hitcount 10 -j
            DROP<br></span>
          <p>Enable persistence of the iptables rules across server reboots:</p><span
            class="commands">DEBIAN_FRONTEND=noninteractive apt install -q -y netfilter-persistent
            iptables-persistent<br>service netfilter-persistent save</span>
        </li>
      </ol>
      <br>
      <u>Note</u>: <a href="https://bugzilla.mindrot.org/show_bug.cgi?id=2793">Because of a bug in OpenSSH</a>, 2048-bit
      DH moduli will still be used in some limited circumstances. Only a maximum score of 95% is possible.</p>
    </div>

    <hr>

    <div id="ubuntu_22_04_lts">
      <p>
      <h2 class="os-title"><img src="logos/ubuntu.png" /> Ubuntu 22.04 LTS Server <span class="last_modified">Last
          modified:
          April 22, 2024</span><span class="copy_button"><input class="copy_button" type="button"
            value="Copy commands to clipboard" /></span></h2>
      </p>
      <div class="change_log">
        <p>Change Log:</p>
        <ol>
          <li>October 1, 2024: Re-ordered host keys to prioritize ED25519 due to efficiency. Re-ordered cipher list to
            prioritize larger key sizes as a countermeasure to quantum attacks.</li>
          <li>April 22, 2024: added connection throttling instructions to counteract the DHEat denial-of-service attack.
          </li>
        </ol>
      </div>
      <p><u>Note</u>: all commands below are to be executed as the <i>root</i> user.
      <ol>
        <li>
          <h3>Re-generate the RSA and ED25519 keys</h3><span class="commands">rm /etc/ssh/ssh_host_*<br>
            ssh-keygen -t rsa -b 4096 -f /etc/ssh/ssh_host_rsa_key -N ""<br>
            ssh-keygen -t ed25519 -f /etc/ssh/ssh_host_ed25519_key -N ""
          </span>
        </li>
        <li>
          <h3>Enable the ED25519 and RSA keys</h3>Enable the ED25519 and RSA <i>HostKey</i> directives in the
          <i>/etc/ssh/sshd_config</i> file:<br><br><span class="commands">echo -e "\nHostKey
            /etc/ssh/ssh_host_ed25519_key\nHostKey /etc/ssh/ssh_host_rsa_key" >> /etc/ssh/sshd_config</span>
        </li>
        <li>
          <h3>Remove small Diffie-Hellman moduli</h3><span class="commands">awk '$5 >= 3071' /etc/ssh/moduli >
            /etc/ssh/moduli.safe<br>
            mv /etc/ssh/moduli.safe /etc/ssh/moduli</span>
        </li>
        <li>
          <h3>Restrict supported key exchange, cipher, and MAC algorithms</h3><span class="commands">echo -e "# Restrict
            key exchange, cipher, and MAC algorithms, as per sshaudit.com\n# hardening guide.\nKexAlgorithms
            sntrup761x25519-sha512@openssh.com,curve25519-sha256,curve25519-sha256@libssh.org,gss-curve25519-sha256-,diffie-hellman-group16-sha512,gss-group16-sha512-,diffie-hellman-group18-sha512,diffie-hellman-group-exchange-sha256\n\nCiphers
            chacha20-poly1305@openssh.com,aes256-gcm@openssh.com,aes256-ctr,aes192-ctr,aes128-gcm@openssh.com,aes128-ctr\n\nMACs
            hmac-sha2-256-etm@openssh.com,hmac-sha2-512-etm@openssh.com,umac-128-etm@openssh.com\n\nHostKeyAlgorithms
            sk-ssh-ed25519-cert-v01@openssh.com,ssh-ed25519-cert-v01@openssh.com,rsa-sha2-512-cert-v01@openssh.com,rsa-sha2-256-cert-v01@openssh.com,sk-ssh-ed25519@openssh.com,ssh-ed25519,rsa-sha2-512,rsa-sha2-256\n\nCASignatureAlgorithms
            sk-ssh-ed25519@openssh.com,ssh-ed25519,rsa-sha2-512,rsa-sha2-256\n\nGSSAPIKexAlgorithms
            gss-curve25519-sha256-,gss-group16-sha512-\n\nHostbasedAcceptedAlgorithms
            sk-ssh-ed25519-cert-v01@openssh.com,ssh-ed25519-cert-v01@openssh.com,sk-ssh-ed25519@openssh.com,ssh-ed25519,rsa-sha2-512-cert-v01@openssh.com,rsa-sha2-512,rsa-sha2-256-cert-v01@openssh.com,rsa-sha2-256\n\nPubkeyAcceptedAlgorithms
            sk-ssh-ed25519-cert-v01@openssh.com,ssh-ed25519-cert-v01@openssh.com,sk-ssh-ed25519@openssh.com,ssh-ed25519,rsa-sha2-512-cert-v01@openssh.com,rsa-sha2-512,rsa-sha2-256-cert-v01@openssh.com,rsa-sha2-256"
            > /etc/ssh/sshd_config.d/ssh-audit_hardening.conf</span>
        </li>
        <li>
          <h3>Implement connection rate throttling</h3>
          <p>Connection rate throttling is needed in order to protect against the <a
              href="https://www.positronsecurity.com/blog/2024-04-23-an-analysis-of-dheat-dos-against-ssh-in-cloud-environments/">DHEat
              denial-of-service attack</a>. A complete and flexible solution is to use iptables to allow up to 10
            connections every 10 seconds from any one source address. An alternate solution is to set OpenSSH's
            PerSourceMaxStartups directive to 1 (note, however, that this can cause incomplete results during ssh-audit
            scans, as well as other client failures when bursts of connections are made).</p><span
            class="commands">iptables -I INPUT -p tcp --dport 22 -m state --state NEW -m recent --set<br>
            iptables -I INPUT -p tcp --dport 22 -m state --state NEW -m recent --update --seconds 10 --hitcount 10 -j
            DROP<br>
            ip6tables -I INPUT -p tcp --dport 22 -m state --state NEW -m recent --set<br>
            ip6tables -I INPUT -p tcp --dport 22 -m state --state NEW -m recent --update --seconds 10 --hitcount 10 -j
            DROP<br></span>
          <p>Enable persistence of the iptables rules across server reboots:</p><span
            class="commands">DEBIAN_FRONTEND=noninteractive apt install -q -y netfilter-persistent
            iptables-persistent<br>service netfilter-persistent save</span>
        </li>
        <li>
          <h3>Restart OpenSSH server</h3><span class="commands">service ssh restart</span>
        </li>
      </ol>
      <br>
      <u>Note</u>: <a href="https://bugzilla.mindrot.org/show_bug.cgi?id=2793">Because of a bug in OpenSSH</a>, 2048-bit
      DH moduli will still be used in some limited circumstances. Only a maximum score of 95% is possible.</p>
    </div>

    <hr>

    <div id="ubuntu_20_04_lts">
      <p>
      <h2 class="os-title"><img src="logos/ubuntu.png" /> Ubuntu 20.04 LTS Server <span class="last_modified">Last
          modified:
          April 24, 2024</span><span class="copy_button"><input class="copy_button" type="button"
            value="Copy commands to clipboard" /></span></h2>
      </p>
      <div class="change_log">
        <p>Change Log:</p>
        <ol>
          <li>April 24, 2024: added connection throttling instructions to counteract the DHEat denial-of-service attack.
          </li>
        </ol>
      </div>
      <p><u>Note</u>: all commands below are to be executed as the <i>root</i> user.
      <ol>
        <li>
          <h3>Re-generate the RSA and ED25519 keys</h3><span class="commands">rm /etc/ssh/ssh_host_*<br>
            ssh-keygen -t rsa -b 4096 -f /etc/ssh/ssh_host_rsa_key -N ""<br>
            ssh-keygen -t ed25519 -f /etc/ssh/ssh_host_ed25519_key -N ""
          </span>
        </li>
        <li>
          <h3>Remove small Diffie-Hellman moduli</h3><span class="commands">awk '$5 >= 3071' /etc/ssh/moduli >
            /etc/ssh/moduli.safe<br>
            mv /etc/ssh/moduli.safe /etc/ssh/moduli</span>
        </li>
        <li>
          <h3>Enable the RSA and ED25519 keys</h3>Enable the RSA and ED25519 <i>HostKey</i> directives in the
          <i>/etc/ssh/sshd_config</i> file:<br><br><span class="commands">sed -i 's/^\#HostKey
            \/etc\/ssh\/ssh_host_\(rsa\|ed25519\)_key$/HostKey \/etc\/ssh\/ssh_host_\1_key/g'
            /etc/ssh/sshd_config</span>
        </li>
        <li>
          <h3>Restrict supported key exchange, cipher, and MAC algorithms</h3><span class="commands">echo -e "\n#
            Restrict key exchange, cipher, and MAC algorithms, as per sshaudit.com\n# hardening guide.\nKexAlgorithms
            curve25519-sha256,curve25519-sha256@libssh.org,diffie-hellman-group16-sha512,diffie-hellman-group18-sha512,diffie-hellman-group-exchange-sha256\nCiphers
            chacha20-poly1305@openssh.com,aes256-gcm@openssh.com,aes128-gcm@openssh.com,aes256-ctr,aes192-ctr,aes128-ctr\nMACs
            hmac-sha2-256-etm@openssh.com,hmac-sha2-512-etm@openssh.com,umac-128-etm@openssh.com\nHostKeyAlgorithms
            ssh-ed25519,ssh-ed25519-cert-v01@openssh.com,sk-ssh-ed25519@openssh.com,sk-ssh-ed25519-cert-v01@openssh.com,rsa-sha2-256,rsa-sha2-512,rsa-sha2-256-cert-v01@openssh.com,rsa-sha2-512-cert-v01@openssh.com"
            > /etc/ssh/sshd_config.d/ssh-audit_hardening.conf</span>
        </li>
        <li>
          <h3>Restart OpenSSH server</h3><span class="commands">service ssh restart</span>
        </li>
        <li>
          <h3>Implement connection rate throttling</h3>
          <p>Connection rate throttling is needed in order to protect against the <a
              href="https://www.positronsecurity.com/blog/2024-04-23-an-analysis-of-dheat-dos-against-ssh-in-cloud-environments/">DHEat
              denial-of-service attack</a>. A complete and flexible solution is to use iptables to allow up to 10
            connections every 10 seconds from any one source address. An alternate solution is to set OpenSSH's
            PerSourceMaxStartups directive to 1 (note, however, that this can cause incomplete results during ssh-audit
            scans, as well as other client failures when bursts of connections are made).</p><span
            class="commands">iptables -I INPUT -p tcp --dport 22 -m state --state NEW -m recent --set<br>
            iptables -I INPUT -p tcp --dport 22 -m state --state NEW -m recent --update --seconds 10 --hitcount 10 -j
            DROP<br>
            ip6tables -I INPUT -p tcp --dport 22 -m state --state NEW -m recent --set<br>
            ip6tables -I INPUT -p tcp --dport 22 -m state --state NEW -m recent --update --seconds 10 --hitcount 10 -j
            DROP<br></span>
          <p>Enable persistence of the iptables rules across server reboots:</p><span
            class="commands">DEBIAN_FRONTEND=noninteractive apt install -q -y netfilter-persistent
            iptables-persistent<br>service netfilter-persistent save</span>
        </li>
      </ol>
      <br>
      <u>Note</u>: <a href="https://bugzilla.mindrot.org/show_bug.cgi?id=2793">Because of a bug in OpenSSH</a>, 2048-bit
      DH moduli will still be used in some limited circumstances. Only a maximum score of 95% is possible.</p>
    </div>

    <hr>

    <div id="debian_12">
      <p>
      <h2 class="os-title">Debian Bookworm (Debian 12) <span class="last_modified">Last modified: April 18, 2025</span>
        <span class="copy_button"><input class="copy_button" type="button" value="Copy commands to clipboard" /></span>
      </h2>
      </p>
      <div class="change_log">
        <p>Change Log:</p>
        <ol>
          <li>April 18, 2025: Added sntrup761x25519-sha512 to KexAlgorithms.</li>
          <li>October 1, 2024: Re-ordered host keys to prioritize ED25519 due to efficiency. Re-ordered cipher list to
            prioritize larger key sizes as a countermeasure to quantum attacks.</li>
          <li>April 24, 2024: added connection throttling instructions to counteract the DHEat denial-of-service attack.
          </li>
        </ol>
      </div>
      <p><u>Note</u>: all commands below are to be executed as the <i>root</i> user.
      <ol>
        <li>
          <h3>Re-generate the RSA and ED25519 keys</h3><span class="commands">rm /etc/ssh/ssh_host_*<br>
            ssh-keygen -t rsa -b 4096 -f /etc/ssh/ssh_host_rsa_key -N ""<br>
            ssh-keygen -t ed25519 -f /etc/ssh/ssh_host_ed25519_key -N ""
          </span>
        </li>
        <li>
          <h3>Enable the ED25519 and RSA keys</h3>Enable the ED25519 and RSA <i>HostKey</i> directives in the
          <i>/etc/ssh/sshd_config</i> file:<br><br><span class="commands">echo -e "\nHostKey
            /etc/ssh/ssh_host_ed25519_key\nHostKey /etc/ssh/ssh_host_rsa_key" >> /etc/ssh/sshd_config</span>
        </li>
        <li>
          <h3>Remove small Diffie-Hellman moduli</h3><span class="commands">awk '$5 >= 3071' /etc/ssh/moduli >
            /etc/ssh/moduli.safe<br>
            mv /etc/ssh/moduli.safe /etc/ssh/moduli</span>
        </li>
        <li>
          <h3>Restrict supported key exchange, cipher, and MAC algorithms</h3><span class="commands">echo -e "# Restrict
            key exchange, cipher, and MAC algorithms, as per sshaudit.com\n# hardening guide.\n
            KexAlgorithms
            sntrup761x25519-sha512,sntrup761x25519-sha512@openssh.com,curve25519-sha256,curve25519-sha256@libssh.org,gss-curve25519-sha256-,diffie-hellman-group16-sha512,gss-group16-sha512-,diffie-hellman-group18-sha512,diffie-hellman-group-exchange-sha256\n\nCiphers
            chacha20-poly1305@openssh.com,aes256-gcm@openssh.com,aes256-ctr,aes192-ctr,aes128-gcm@openssh.com,aes128-ctr\n\nMACs
            hmac-sha2-256-etm@openssh.com,hmac-sha2-512-etm@openssh.com,umac-128-etm@openssh.com\n\nHostKeyAlgorithms
            sk-ssh-ed25519-cert-v01@openssh.com,ssh-ed25519-cert-v01@openssh.com,rsa-sha2-512-cert-v01@openssh.com,rsa-sha2-256-cert-v01@openssh.com,sk-ssh-ed25519@openssh.com,ssh-ed25519,rsa-sha2-512,rsa-sha2-256\n\nRequiredRSASize
            3072\n\nCASignatureAlgorithms
            sk-ssh-ed25519@openssh.com,ssh-ed25519,rsa-sha2-512,rsa-sha2-256\n\nGSSAPIKexAlgorithms
            gss-curve25519-sha256-,gss-group16-sha512-\n\nHostbasedAcceptedAlgorithms
            sk-ssh-ed25519-cert-v01@openssh.com,ssh-ed25519-cert-v01@openssh.com,sk-ssh-ed25519@openssh.com,ssh-ed25519,rsa-sha2-512-cert-v01@openssh.com,rsa-sha2-512,rsa-sha2-256-cert-v01@openssh.com,rsa-sha2-256\n\nPubkeyAcceptedAlgorithms
            sk-ssh-ed25519-cert-v01@openssh.com,ssh-ed25519-cert-v01@openssh.com,sk-ssh-ed25519@openssh.com,ssh-ed25519,rsa-sha2-512-cert-v01@openssh.com,rsa-sha2-512,rsa-sha2-256-cert-v01@openssh.com,rsa-sha2-256\n\n"
            > /etc/ssh/sshd_config.d/ssh-audit_hardening.conf</span>
        </li>
        <li>
          <h3>Restart OpenSSH server</h3><span class="commands">service ssh restart</span>
        </li>
        <li>
          <h3>Implement connection rate throttling</h3>
          <p>Connection rate throttling is needed in order to protect against the <a
              href="https://www.positronsecurity.com/blog/2024-04-23-an-analysis-of-dheat-dos-against-ssh-in-cloud-environments/">DHEat
              denial-of-service attack</a>. A complete and flexible solution is to use iptables to allow up to 10
            connections every 10 seconds from any one source address. An alternate solution is to set OpenSSH's
            PerSourceMaxStartups directive to 1 (note, however, that this can cause incomplete results during ssh-audit
            scans, as well as other client failures when bursts of connections are made).</p><span
            class="commands">DEBIAN_FRONTEND=noninteractive apt install -q -y iptables netfilter-persistent
            iptables-persistent<br>
            iptables -I INPUT -p tcp --dport 22 -m state --state NEW -m recent --set<br>
            iptables -I INPUT -p tcp --dport 22 -m state --state NEW -m recent --update --seconds 10 --hitcount 10 -j
            DROP<br>
            ip6tables -I INPUT -p tcp --dport 22 -m state --state NEW -m recent --set<br>
            ip6tables -I INPUT -p tcp --dport 22 -m state --state NEW -m recent --update --seconds 10 --hitcount 10 -j
            DROP<br></span>
          <p>Enable persistence of the iptables rules across server reboots:</p><span class="commands">service
            netfilter-persistent save</span>
        </li>
      </ol>
      </p>
    </div>

    <hr>

    <div id="debian_11">
      <p>
      <h2 class="os-title">Debian Bullseye (Debian 11) <span class="last_modified">Last modified: September 17,
          2021</span><span class="copy_button"><input class="copy_button" type="button"
            value="Copy commands to clipboard" /></span></h2>
      </p>
      <p><u>Note</u>: all commands below are to be executed as the <i>root</i> user.
      <ol>
        <li>
          <h3>Re-generate the RSA and ED25519 keys</h3><span class="commands">rm -f /etc/ssh/ssh_host_*<br>
            ssh-keygen -t rsa -b 4096 -f /etc/ssh/ssh_host_rsa_key -N ""<br>
            ssh-keygen -t ed25519 -f /etc/ssh/ssh_host_ed25519_key -N ""<br>
          </span>
        </li>
        <li>
          <h3>Enable the RSA and ED25519 keys</h3>Enable the RSA and ED25519 <i>HostKey</i> directives in the
          <i>/etc/ssh/sshd_config</i> file:<br><br><span class="commands">sed -i 's/^\#HostKey
            \/etc\/ssh\/ssh_host_\(rsa\|ed25519\)_key$/HostKey \/etc\/ssh\/ssh_host_\1_key/g'
            /etc/ssh/sshd_config<br></span>
        </li>
        <li>
          <h3>Remove small Diffie-Hellman moduli</h3><span class="commands">awk '$5 >= 3071' /etc/ssh/moduli >
            /etc/ssh/moduli.safe<br>
            mv -f /etc/ssh/moduli.safe /etc/ssh/moduli<br></span>
        </li>
        <li>
          <h3>Restrict supported key exchange, cipher, and MAC algorithms</h3><span class="commands">echo -e "\n#
            Restrict key exchange, cipher, and MAC algorithms, as per sshaudit.com\n# hardening guide.\nKexAlgorithms
            curve25519-sha256,curve25519-sha256@libssh.org,diffie-hellman-group16-sha512,diffie-hellman-group18-sha512,diffie-hellman-group-exchange-sha256\nCiphers
            chacha20-poly1305@openssh.com,aes256-gcm@openssh.com,aes128-gcm@openssh.com,aes256-ctr,aes192-ctr,aes128-ctr\nMACs
            hmac-sha2-256-etm@openssh.com,hmac-sha2-512-etm@openssh.com,umac-128-etm@openssh.com\nHostKeyAlgorithms
            ssh-ed25519,ssh-ed25519-cert-v01@openssh.com,sk-ssh-ed25519@openssh.com,sk-ssh-ed25519-cert-v01@openssh.com,rsa-sha2-256,rsa-sha2-512,rsa-sha2-256-cert-v01@openssh.com,rsa-sha2-512-cert-v01@openssh.com"
            > /etc/ssh/sshd_config.d/ssh-audit_hardening.conf</span>
        </li>
        <li>
          <h3>Restart OpenSSH server</h3><span class="commands">service ssh restart</span>
        </li>
      </ol>
      </p>
    </div>

    <hr>

    <div id="rocky_9">
      <p>
      <h2 class="os-title"><img class="distro_logo" src="logos/rocky.svg" /> Rocky Linux 9 <span
          class="last_modified">Last
          modified: October 1, 2024</span><span class="copy_button"><input class="copy_button" type="button"
            value="Copy commands to clipboard" /></span></h2>
      </p>
      <div class="change_log">
        <p>Change Log:</p>
        <ol>
          <li>October 1, 2024: Re-ordered host keys to prioritize ED25519 due to efficiency. Re-ordered cipher list to
            prioritize larger key sizes as a countermeasure to quantum attacks.</li>
          <li>April 24, 2024: added connection throttling instructions to counteract the DHEat denial-of-service attack.
          </li>
        </ol>
      </div>
      <p><u>Note</u>: all commands below are to be executed as the <i>root</i> user.
      <ol>
        <li>
          <h3>Re-generate the RSA and ED25519 keys</h3><span class="commands">rm -f /etc/ssh/ssh_host_*<br>
            ssh-keygen -t rsa -b 4096 -f /etc/ssh/ssh_host_rsa_key -N ""<br>
            ssh-keygen -t ed25519 -f /etc/ssh/ssh_host_ed25519_key -N ""
          </span>
        </li>
        <li>
          <h3>Enable the ED25519 and RSA keys</h3>Enable the ED25519 and RSA <i>HostKey</i> directives in the
          <i>/etc/ssh/sshd_config</i> file:<br><br><span class="commands">echo -e "\nHostKey
            /etc/ssh/ssh_host_ed25519_key\nHostKey /etc/ssh/ssh_host_rsa_key" >> /etc/ssh/sshd_config</span>
        </li>
        <li>
          <h3>Remove small Diffie-Hellman moduli</h3><span class="commands">awk '$5 >= 3071' /etc/ssh/moduli >
            /etc/ssh/moduli.safe<br>
            mv -f /etc/ssh/moduli.safe /etc/ssh/moduli</span>
        </li>
        <li>
          <h3>Restrict supported key exchange, cipher, and MAC algorithms</h3><span class="commands">echo -e "# Restrict
            key exchange, cipher, and MAC algorithms, as per sshaudit.com\n# hardening guide.\nKexAlgorithms
            sntrup761x25519-sha512@openssh.com,curve25519-sha256,curve25519-sha256@libssh.org,gss-curve25519-sha256-,diffie-hellman-group16-sha512,gss-group16-sha512-,diffie-hellman-group18-sha512,diffie-hellman-group-exchange-sha256\n\nCiphers
            chacha20-poly1305@openssh.com,aes256-gcm@openssh.com,aes256-ctr,aes192-ctr,aes128-gcm@openssh.com,aes128-ctr\n\nMACs
            hmac-sha2-256-etm@openssh.com,hmac-sha2-512-etm@openssh.com,umac-128-etm@openssh.com\n\nHostKeyAlgorithms
            sk-ssh-ed25519-cert-v01@openssh.com,ssh-ed25519-cert-v01@openssh.com,rsa-sha2-512-cert-v01@openssh.com,rsa-sha2-256-cert-v01@openssh.com,sk-ssh-ed25519@openssh.com,ssh-ed25519,rsa-sha2-512,rsa-sha2-256\n\nRequiredRSASize
            3072\n\nCASignatureAlgorithms
            sk-ssh-ed25519@openssh.com,ssh-ed25519,rsa-sha2-512,rsa-sha2-256\n\nGSSAPIKexAlgorithms
            gss-curve25519-sha256-,gss-group16-sha512-\n\nHostbasedAcceptedAlgorithms
            sk-ssh-ed25519-cert-v01@openssh.com,ssh-ed25519-cert-v01@openssh.com,sk-ssh-ed25519@openssh.com,ssh-ed25519,rsa-sha2-512-cert-v01@openssh.com,rsa-sha2-512,rsa-sha2-256-cert-v01@openssh.com,rsa-sha2-256\n\nPubkeyAcceptedAlgorithms
            sk-ssh-ed25519-cert-v01@openssh.com,ssh-ed25519-cert-v01@openssh.com,rsa-sha2-512-cert-v01@openssh.com,rsa-sha2-256-cert-v01@openssh.com,sk-ssh-ed25519@openssh.com,ssh-ed25519,rsa-sha2-512,rsa-sha2-256\n\n"
            > /etc/crypto-policies/back-ends/opensshserver.config</span>
        </li>
        <li>
          <h3>Restart OpenSSH server</h3><span class="commands">systemctl restart sshd</span>
        </li>
        <li>
          <h3>Implement connection rate throttling</h3>
          <p>Connection rate throttling is needed in order to protect against the <a
              href="https://www.positronsecurity.com/blog/2024-04-23-an-analysis-of-dheat-dos-against-ssh-in-cloud-environments/">DHEat
              denial-of-service attack</a>. A complete and flexible solution is to use iptables/firewalld to allow up to
            10 connections every 10 seconds from any one source address. An alternate solution is to set OpenSSH's
            PerSourceMaxStartups directive to 1 (note, however, that this can cause incomplete results during ssh-audit
            scans, as well as other client failures when bursts of connections are made).</p><span
            class="commands">firewall-cmd --permanent --direct --add-rule ipv4 filter INPUT 0 -p tcp --dport 22 -m state
            --state NEW -m recent --set<br>
            firewall-cmd --permanent --direct --add-rule ipv4 filter INPUT 1 -p tcp --dport 22 -m state --state NEW -m
            recent --update --seconds 10 --hitcount 10 -j DROP<br>
            firewall-cmd --permanent --direct --add-rule ipv6 filter INPUT 0 -p tcp --dport 22 -m state --state NEW -m
            recent --set<br>
            firewall-cmd --permanent --direct --add-rule ipv6 filter INPUT 1 -p tcp --dport 22 -m state --state NEW -m
            recent --update --seconds 10 --hitcount 10 -j DROP</span>
          <p>Reload firewalld to enable new rules:</p><span class="commands">systemctl reload firewalld</span>
        </li>
      </ol>
      </p>
    </div>

    <hr>

    <div id="amazon_linux_2023">
      <p>
      <h2 class="os-title">Amazon Linux 2023 <span class="last_modified">Last modified: October 1, 2024</span><span
          class="copy_button"><input class="copy_button" type="button" value="Copy commands to clipboard" /></span></h2>
      </p>
      <div class="change_log">
        <p>Change Log:</p>
        <ol>
          <li>October 1, 2024: Re-ordered host keys to prioritize ED25519 due to efficiency. Re-ordered cipher list to
            prioritize larger key sizes as a countermeasure to quantum attacks.</li>
          <li>April 22, 2024: added connection throttling instructions to counteract the DHEat denial-of-service attack.
          </li>
          <li>March 15, 2024: Initial revision.</li>
        </ol>
      </div>
      <p><u>Note</u>: all commands below are to be executed as the <i>root</i> user.
      <ol>
        <li>
          <h3>Re-generate the RSA and ED25519 keys</h3><span class="commands">rm -f /etc/ssh/ssh_host_*<br>
            ssh-keygen -t rsa -b 4096 -f /etc/ssh/ssh_host_rsa_key -N ""<br>
            ssh-keygen -t ed25519 -f /etc/ssh/ssh_host_ed25519_key -N ""
          </span>
        </li>
        <li>
          <h3>Enable the ED25519 and RSA keys</h3>Enable the ED25519 and RSA <i>HostKey</i> directives in the
          <i>/etc/ssh/sshd_config</i> file:<br><br><span class="commands">echo -e "\nHostKey
            /etc/ssh/ssh_host_ed25519_key\nHostKey /etc/ssh/ssh_host_rsa_key" >> /etc/ssh/sshd_config</span>
        </li>
        <li>
          <h3>Remove small Diffie-Hellman moduli</h3><span class="commands">awk '$5 >= 3071' /etc/ssh/moduli >
            /etc/ssh/moduli.safe<br>
            mv -f /etc/ssh/moduli.safe /etc/ssh/moduli</span>
        </li>
        <li>
          <h3>Restrict supported key exchange, cipher, and MAC algorithms</h3><span class="commands">echo -e "# Restrict
            key exchange, cipher, and MAC algorithms, as per sshaudit.com\n# hardening guide.\nKexAlgorithms
            sntrup761x25519-sha512@openssh.com,curve25519-sha256,curve25519-sha256@libssh.org,gss-curve25519-sha256-,diffie-hellman-group16-sha512,gss-group16-sha512-,diffie-hellman-group18-sha512,diffie-hellman-group-exchange-sha256\n\nCiphers
            chacha20-poly1305@openssh.com,aes256-gcm@openssh.com,aes256-ctr,aes192-ctr,aes128-gcm@openssh.com,aes128-ctr\n\nMACs
            hmac-sha2-256-etm@openssh.com,hmac-sha2-512-etm@openssh.com,umac-128-etm@openssh.com\n\nHostKeyAlgorithms
            sk-ssh-ed25519-cert-v01@openssh.com,ssh-ed25519-cert-v01@openssh.com,rsa-sha2-512-cert-v01@openssh.com,rsa-sha2-256-cert-v01@openssh.com,sk-ssh-ed25519@openssh.com,ssh-ed25519,rsa-sha2-512,rsa-sha2-256\n\nCASignatureAlgorithms
            sk-ssh-ed25519@openssh.com,ssh-ed25519,rsa-sha2-512,rsa-sha2-256\n\nGSSAPIKexAlgorithms
            gss-curve25519-sha256-,gss-group16-sha512-\n\nHostbasedAcceptedAlgorithms
            sk-ssh-ed25519-cert-v01@openssh.com,ssh-ed25519-cert-v01@openssh.com,sk-ssh-ed25519@openssh.com,ssh-ed25519,rsa-sha2-512-cert-v01@openssh.com,rsa-sha2-512,rsa-sha2-256-cert-v01@openssh.com,rsa-sha2-256\n\nPubkeyAcceptedAlgorithms
            sk-ssh-ed25519-cert-v01@openssh.com,ssh-ed25519-cert-v01@openssh.com,rsa-sha2-512-cert-v01@openssh.com,rsa-sha2-256-cert-v01@openssh.com,sk-ssh-ed25519@openssh.com,ssh-ed25519,rsa-sha2-512,rsa-sha2-256\n\n"
            > /etc/crypto-policies/back-ends/opensshserver.config</span>
        </li>
        <li>
          <h3>Restart OpenSSH server</h3><span class="commands">systemctl restart sshd</span>
        </li>
        <li>
          <h3>Implement connection rate throttling</h3>
          <p>Connection rate throttling is needed in order to protect against the <a
              href="https://www.positronsecurity.com/blog/2024-04-23-an-analysis-of-dheat-dos-against-ssh-in-cloud-environments/">DHEat
              denial-of-service attack</a>. A complete and flexible solution is to use iptables to allow up to 10
            connections every 10 seconds from any one source address. An alternate solution is to set OpenSSH's
            PerSourceMaxStartups directive to 1 (note, however, that this can cause incomplete results during ssh-audit
            scans, as well as other client failures when bursts of connections are made).</p><span class="commands">dnf
            install -y iptables<br>
            iptables -I INPUT -p tcp --dport 22 -m state --state NEW -m recent --set<br>
            iptables -I INPUT -p tcp --dport 22 -m state --state NEW -m recent --update --seconds 10 --hitcount 10 -j
            DROP<br>
            ip6tables -I INPUT -p tcp --dport 22 -m state --state NEW -m recent --set<br>
            ip6tables -I INPUT -p tcp --dport 22 -m state --state NEW -m recent --update --seconds 10 --hitcount 10 -j
            DROP<br></span>
          <p>Enable persistence of the iptables rules across server reboots:</p><span class="commands">dnf install -y
            iptables-services<br>iptables-save > /etc/sysconfig/iptables<br>ip6tables-save >
            /etc/sysconfig/ip6tables<br>systemctl enable iptables<br>systemctl enable ip6tables<br>systemctl start
            iptables<br>systemctl start ip6tables</span>
        </li>
      </ol>
      </p>
    </div>

  </div>
</body>

</html>